(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.Store = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
// Array.prototype.find - MIT License (c) 2013 Paul Miller <http://paulmillr.com>
// For all details and docs: https://github.com/paulmillr/array.prototype.find
// Fixes and tests supplied by Duncan Hall <http://duncanhall.net> 
(function(globals){
  if (Array.prototype.find) return;

  var find = function(predicate) {
    var list = Object(this);
    var length = list.length < 0 ? 0 : list.length >>> 0; // ES.ToUint32;
    if (length === 0) return undefined;
    if (typeof predicate !== 'function' || Object.prototype.toString.call(predicate) !== '[object Function]') {
      throw new TypeError('Array#find: predicate must be a function');
    }
    var thisArg = arguments[1];
    for (var i = 0, value; i < length; i++) {
      value = list[i];
      if (predicate.call(thisArg, value, i, list)) return value;
    }
    return undefined;
  };

  if (Object.defineProperty) {
    try {
      Object.defineProperty(Array.prototype, 'find', {
        value: find, configurable: true, enumerable: false, writable: true
      });
    } catch(e) {}
  }

  if (!Array.prototype.find) {
    Array.prototype.find = find;
  }
})(this);

},{}],2:[function(require,module,exports){
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),AjaxAdapter=function(){function e(t){_classCallCheck(this,e),this._base=t&&t.base||""}return _createClass(e,[{key:"create",value:function(e,t,n,a,o,s){var l=this;if(o&&"[object Function]"!=={}.toString.call(o))this.create(e,t,n,a,null,o);else{if(!e._types[t])throw new Error("Unknown type '"+t+"'");!function(){var i=new XMLHttpRequest;i.open("POST",l._base+"/"+t,!0),i.setRequestHeader("Content-Type","application/vnd.api+json"),i.onload=function(){if(i.status>=200&&i.status<300){var t=JSON.parse(i.responseText);try{e.push(t),a&&a.call(s,e.find(t.data.type,t.data.id))}catch(n){o&&o.call(s,n)}}else o&&o.call(s)},i.send(JSON.stringify({data:e.convert(t,n)}))}()}}},{key:"destroy",value:function(e,t,n,a,o,s){var l=this;if(o&&"[object Function]"!=={}.toString.call(o))this.destroy(e,t,n,a,null,o);else{if(!e._types[t])throw new Error("Unknown type '"+t+"'");!function(){var i=new XMLHttpRequest;i.open("DELETE",l._base+"/"+t+"/"+n,!0),i.setRequestHeader("Content-Type","application/vnd.api+json"),i.onload=function(){if(i.status>=200&&i.status<300)try{e.remove(t,n),a&&a.call(s)}catch(l){o.call(s,l)}else o&&o.call(s)},i.send()}()}}},{key:"load",value:function(e,t,n,a,o,s,l){var i=this;if(n&&"[object Function]"==={}.toString.call(n))this.load(e,t,null,null,n,a,o);else if(n&&"object"==typeof n)this.load(e,t,null,n,a,o,s);else if(a&&"[object Function]"==={}.toString.call(a))this.load(e,t,n,{},a,o,s);else if(s&&"[object Function]"!=={}.toString.call(s))this.load(e,t,n,a,o,null,s);else{if(!e._types[t])throw new Error("Unknown type '"+t+"'");!function(){var r=new XMLHttpRequest,c=void 0;if(a=a||{},c=n?i._base+"/"+t+"/"+n:i._base+"/"+t,a){var u=[];a.fields&&(Object.keys(a.fields).forEach(function(e){a["fields["+e+"]"]=a.fields[e]}),delete a.fields),u=Object.keys(a).map(function(e){return e+"="+encodeURIComponent(a[e])}).sort(),u.length&&(c=c+"?"+u.join("&"))}r.open("GET",c,!0),r.setRequestHeader("Content-Type","application/vnd.api+json"),r.onload=function(){if(r.status>=200&&r.status<300)try{e.push(JSON.parse(r.responseText)),o&&o.call(l,n?e.find(t,n):e.find(t))}catch(a){s.call({},a)}else s&&s.call(l)},r.send()}()}}},{key:"update",value:function(e,t,n,a,o,s,l){var i=this;if(s&&"[object Function]"!=={}.toString.call(s))this.update(e,t,n,a,o,null,s);else{if(!e._types[t])throw new Error("Unknown type '"+t+"'");!function(){var r=new XMLHttpRequest,c=e.convert(t,n,a);r.open("PATCH",i._base+"/"+t+"/"+n,!0),r.setRequestHeader("Content-Type","application/vnd.api+json"),r.onload=function(){if(r.status>=200&&r.status<300)try{e.add(c),o&&o.call(l,e.find(c.type,c.id))}catch(t){s&&s.call(l,t)}else s&&s.call(l)},r.send(JSON.stringify({data:c}))}()}}}]),e}();exports["default"]=AjaxAdapter,module.exports=exports["default"];

},{}],3:[function(require,module,exports){
"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();require("array.prototype.find");var _ajaxAdapter=require("./ajax-adapter"),_ajaxAdapter2=_interopRequireDefault(_ajaxAdapter),Store=function(){function e(t){_classCallCheck(this,e),this._adapter=t,this._collectionListeners={added:{},updated:{},removed:{}},this._data={},this._resourceListeners={added:{},updated:{},removed:{}},this._types={}}return _createClass(e,null,[{key:"attr",value:function(t,r){return t&&"object"==typeof t?e.attr(null,t):{type:"attr","default":r&&r["default"],deserialize:function(e,r){return e.attributes&&e.attributes[t||r]},serialize:function(e,r,n){r.attributes[t||n]=e[n]}}}},{key:"hasOne",value:function(t,r){return t&&"object"==typeof t?e.hasOne(null,t):{type:"has-one",inverse:r&&r.inverse,deserialize:function(e,r){if(t=t||r,e.relationships&&e.relationships[t]){if(null===e.relationships[t].data)return null;if(e.relationships[t].data)return this.find(e.relationships[t].data.type,e.relationships[t].data.id)}}}}},{key:"hasMany",value:function(t,r){return t&&"object"==typeof t?e.hasMany(null,t):{type:"has-many","default":[],inverse:r&&r.inverse,deserialize:function(e,r){var n=this;if(t=t||r,e.relationships&&e.relationships[t]){if(null===e.relationships[t].data)return[];if(e.relationships[t].data)return e.relationships[t].data.map(function(e){return n.find(e.type,e.id)})}}}}}]),_createClass(e,[{key:"add",value:function(e){var t=this;if(!e)throw new TypeError("You must provide data to add");if(!e.type||!e.id)throw new TypeError("The data must have a type and id");!function(){var r=t._data[e.type]&&t._data[e.type][e.id]?"updated":"added",n=t.find(e.type,e.id),i=t._types[e.type];Object.keys(i).forEach(function(r){"_"!==r[0]&&t._addField(e,n,i,r)}),t._resourceListeners[r][e.type]&&t._resourceListeners[r][e.type][e.id]&&t._resourceListeners[r][e.type][e.id].forEach(function(e){return e[0].call(e[1],n)}),t._collectionListeners[r][e.type]&&t._collectionListeners[r][e.type].forEach(function(e){return e[0].call(e[1],n)})}()}},{key:"convert",value:function(e,t,r){var n=this;if(e&&"object"==typeof e)return this.convert(e.type,e.id,e);if(t&&"object"==typeof t)return this.convert(e,t.id,t);var i=function(){var i={type:e,attributes:{},relationships:{}};t&&(i.id=t);var a=n._types[i.type];return Object.keys(a).forEach(function(e){"_"!==e[0]&&a[e].serialize(r,i,e)}),{v:i}}();return"object"==typeof i?i.v:void 0}},{key:"create",value:function(e,t,r,n,i){if(!this._adapter)throw new Error("Adapter missing. Specify an adapter when creating the store: `var store = new Store(adapter);`");this._adapter.create(this,e,t,r,n,i)}},{key:"define",value:function(e,t){var r=this;if(e=e.constructor===Array?e:[e],!t)throw new Error("You must provide a definition for the type '"+e[0]+"'.");t._names=e,e.forEach(function(e){if(r._types[e])throw new Error("The type '"+e+"' has already been defined.");r._types[e]=t})}},{key:"destroy",value:function(e,t,r,n,i){if(!this._adapter)throw new Error("Adapter missing. Specify an adapter when creating the store: `var store = new Store(adapter);`");this._adapter.destroy(this,e,t,r,n,i)}},{key:"find",value:function(e,t){var r=this;if(!e)throw new TypeError("You must provide a type");var n=function(){var n=r._types[e];if(n)return r._data[e]||!function(){var e={};n._names.forEach(function(t){return r._data[t]=e})}(),t?(r._data[e][t]||(r._data[e][t]={_dependents:[],type:e,id:t},Object.keys(n).forEach(function(i){"_"!==i[0]&&(r._data[e][t][i]=n[i]["default"])})),{v:r._data[e][t]}):{v:Object.keys(r._data[e]).map(function(t){return r._data[e][t]})};throw new TypeError("Unknown type '"+e+"'")}();return"object"==typeof n?n.v:void 0}},{key:"load",value:function(e,t,r,n,i,a){if(!this._adapter)throw new Error("Adapter missing. Specify an adapter when creating the store: `var store = new Store(adapter);`");this._adapter.load(this,e,t,r,n,i,a)}},{key:"off",value:function(e,t,r,n){var i=this;if(!this._resourceListeners[e]||!this._collectionListeners[e])throw new Error("Unknown event '"+e+"'");if(!this._types[t])throw new Error("Unknown type '"+t+"'");r&&"[object Function]"==={}.toString.call(r)?this.off.call(this,e,t,null,r,n):this._types[t]._names.forEach(function(t){r?i._resourceListeners[e][t]&&i._resourceListeners[e][t][r]&&(i._resourceListeners[e][t][r]=i._resourceListeners[e][t][r].filter(function(e){return e[0]!==n})):i._collectionListeners[e][t]&&(i._collectionListeners[e][t]=i._collectionListeners[e][t].filter(function(e){return e[0]!==n}))})}},{key:"on",value:function(e,t,r,n,i){var a=this;if(!this._resourceListeners[e]||!this._collectionListeners[e])throw new Error("Unknown event '"+e+"'");if(!this._types[t])throw new Error("Unknown type '"+t+"'");r&&"[object Function]"==={}.toString.call(r)?this.on.call(this,e,t,null,r,n):this._types[t]._names.forEach(function(t){r?(a._resourceListeners[e][t]=a._resourceListeners[e][t]||{},a._resourceListeners[e][t][r]=a._resourceListeners[e][t][r]||[],a._resourceListeners[e][t][r].find(function(e){return e[0]===n})||a._resourceListeners[e][t][r].push([n,i])):(a._collectionListeners[e][t]=a._collectionListeners[e][t]||[],a._collectionListeners[e][t].find(function(e){return e[0]===n})||a._collectionListeners[e][t].push([n,i]))})}},{key:"push",value:function(e){var t=this;e.data.constructor===Array?e.data.forEach(function(e){return t.add(e)}):this.add(e.data),e.included&&e.included.forEach(function(e){return t.add(e)})}},{key:"remove",value:function(e,t){var r=this;if(!e)throw new TypeError("You must provide a type to remove");if(!this._types[e])throw new TypeError("Unknown type '"+e+"'");t?!function(){var n=r._data[e]&&r._data[e][t];n&&(r._remove(n),r._resourceListeners.removed[e]&&r._resourceListeners.removed[e][t]&&r._resourceListeners.removed[e][t].forEach(function(e){return e[0].call(e[1],n)}),r._collectionListeners.removed[e]&&r._collectionListeners.removed[e].forEach(function(e){return e[0].call(e[1],n)}))}():Object.keys(this._data[e]).forEach(function(t){return r.remove(e,t)})}},{key:"update",value:function(e,t,r,n,i,a){if(!this._adapter)throw new Error("Adapter missing. Specify an adapter when creating the store: `var store = new Store(adapter);`");this._adapter.update(this,e,t,r,n,i,a)}},{key:"_addField",value:function(e,t,r,n){var i=this,a=r[n],s=a.deserialize.call(this,e,n);"undefined"!=typeof s&&("has-one"===a.type?(t[n]&&this._removeInverseRelationship(t,n,t[n],a),s&&this._addInverseRelationship(t,n,s,a)):"has-many"===a.type&&(t[n].forEach(function(e){-1!==t[n].indexOf(e)&&i._removeInverseRelationship(t,n,e,a)}),s.forEach(function(e){i._addInverseRelationship(t,n,e,a)})),t[n]=s)}},{key:"_addInverseRelationship",value:function(e,t,r,n){var i=this._types[r.type],a=this._types[e.type];if(i){var s=[n.inverse].concat(a._names).find(function(e){return i[e]}),o=i&&i[s];if(r._dependents.push({type:e.type,id:e.id,fieldName:t}),o){if("has-one"===o.type)e._dependents.push({type:r.type,id:r.id,fieldName:s}),r[s]=e;else if("has-many"===o.type)e._dependents.push({type:r.type,id:r.id,fieldName:s}),-1===r[s].indexOf(e)&&r[s].push(e);else if("attr"===o.type)throw new Error("The the inverse relationship for '"+t+"' is an attribute ('"+s+"')")}else if(n.inverse)throw new Error("The the inverse relationship for '"+t+"' is missing ('"+n.inverse+"')")}}},{key:"_remove",value:function(e){var t=this;e._dependents.forEach(function(r){var n=t._data[r.type][r.id];switch(t._types[r.type][r.fieldName].type){case"has-one":n[r.fieldName]=null;break;case"has-many":var i=n[r.fieldName].indexOf(e);-1!==i&&n[r.fieldName].splice(i,1)}n._dependents=n._dependents.filter(function(t){return!(t.type===e.type&&t.id===e.id)})}),delete this._data[e.type][e.id]}},{key:"_removeInverseRelationship",value:function(e,t,r,n){var i=this._types[r.type],a=n.inverse||e.type,s=i&&i[a];if(r._dependents=r._dependents.filter(function(r){return!(r.type===e.type&&r.id===e.id&&r.fieldName===t)}),s){if("has-one"===s.type)e._dependents=e._dependents.filter(function(e){return!(e.type===r.type&&e.id===r.id&&e.fieldName===a)}),r[a]=null;else if("has-many"===s.type)e._dependents=e._dependents.filter(function(e){return!(e.type===r.type&&e.id===r.id&&e.fieldName===a)}),r[a]=r[a].filter(function(t){return t!==e});else if("attr"===s.type)throw new Error("The the inverse relationship for '"+t+"' is an attribute ('"+a+"')")}else if(n.inverse)throw new Error("The the inverse relationship for '"+t+"' is missing ('"+n.inverse+"')")}}]),e}();exports["default"]=Store,Store.AjaxAdapter=_ajaxAdapter2["default"],module.exports=exports["default"];

},{"./ajax-adapter":2,"array.prototype.find":1}]},{},[3])(3)
});